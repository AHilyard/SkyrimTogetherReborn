component("NodeRuntimePlugin")
    set_kind("shared")
    add_deps("ServerPlugins")
    add_files("**.cc")
    add_linkdirs(
        "S:/Work/Research/node/out/Release",
        "S:/Work/Research/node/out/Release/lib")
    add_includedirs(
        "S:/Work/Research/node/src",
        "S:/Work/Research/node/deps/v8/include",
        "S:/Work/Research/node/deps/histogram/src",
        "S:/Work/Research/node/deps/uvwasi/include",
        "S:/Work/Research/node/deps/icu-small/source/i18n",
        "S:/Work/Research/node/deps/icu-small/source/common",
        "S:/Work/Research/node/deps/zlib",
        "S:/Work/Research/node/deps/llhttp/include",
        "S:/Work/Research/node/deps/cares/include",
        "S:/Work/Research/node/deps/uv/include",
        "S:/Work/Research/node/deps/nghttp2/lib/includes",
        "S:/Work/Research/node/deps/brotli/c/include",
        "S:/Work/Research/node/deps/openssl/openssl/include",
        "S:/Work/Research/node/deps/openssl/openssl/crypto/include",
        "S:/Work/Research/node/deps/openssl/config/archs/VC-WIN64A/asm/include",
        "S:/Work/Research/node/deps/openssl/config/archs/VC-WIN64A/asm",
        "S:/Work/Research/node/deps/ngtcp2",
        "S:/Work/Research/node/deps/ngtcp2/ngtcp2/lib/includes",
        "S:/Work/Research/node/deps/ngtcp2/ngtcp2/crypto/includes",
        "S:/Work/Research/node/deps/ngtcp2/nghttp3/lib/includes")
    add_defines(
        "V8_DEPRECATION_WARNINGS",
        "V8_IMMINENT_DEPRECATION_WARNINGS",
        "_GLIBCXX_USE_CXX11_ABI=1",\"NODE_OPENSSL_HAS_QUIC",
        "WIN32",
        "_CRT_SECURE_NO_DEPRECATE",
        "_CRT_NONSTDC_NO_DEPRECATE",
        "_HAS_EXCEPTIONS=0",
        "BUILDING_V8_SHARED=1",
        "BUILDING_UV_SHARED=1",
        "OPENSSL_NO_PINSHARED",
        "OPENSSL_THREADS",
        "NODE_ARCH=\"x64\"",
        "NODE_WANT_INTERNALS=1",
        "FD_SETSIZE=1024",
        "NODE_PLATFORM=\"win32\"",
        "NOMINMAX",
        "_UNICODE=1",
        "NODE_USE_V8_PLATFORM=1",
        "NODE_HAVE_I18N_SUPPORT=1",
        "HAVE_OPENSSL=1",
        "OPENSSL_API_COMPAT=0x10100000L",
        "UCONFIG_NO_SERVICE=1",
        "U_ENABLE_DYLOAD=0",
        "U_STATIC_IMPLEMENTATION=1",
        "U_HAVE_STD_STRING=1",
        "UCONFIG_NO_BREAK_ITERATION=0",
        "NGHTTP2_STATICLIB",
        "NDEBUG",
        "OPENSSL_BUILDING_OPENSSL",
        "OPENSSL_SYS_WIN32",
        "WIN32_LEAN_AND_MEAN",
        "UNICODE",
        "_UNICODE",
        "_WINSOCK_DEPRECATED_NO_WARNINGS",
        "AES_ASM",
        "BSAES_ASM",
        "CMLL_ASM",
        "ECP_NISTZ256_ASM",
        "GHASH_ASM",
        "KECCAK1600_ASM",
        "MD5_ASM",
        "OPENSSL_BN_ASM_GF2m",
        "OPENSSL_BN_ASM_MONT",
        "OPENSSL_BN_ASM_MONT5",
        "OPENSSL_CPUID_OBJ",
        "OPENSSL_IA32_SSE2",
        "PADLOCK_ASM",
        "POLY1305_ASM",
        "SHA1_ASM",
        "SHA256_ASM",
        "SHA512_ASM",
        "VPAES_ASM",
        "WHIRLPOOL_ASM",
        "X25519_ASM",
        "OPENSSL_PIC",
        "NGTCP2_STATICLIB",
        "NGHTTP3_STATICLIB"
    )
    add_links(
        "nghttp2",
        "nghttp3",
        "ngtcp2",
        "openssl",
        "torque_base",
        "uvwasi",
        "v8_base_without_compiler",
        "v8_compiler",
        "v8_init",
        "v8_initializers",
        "v8_libbase",
        "v8_libplatform",
        "v8_snapshot",
        "v8_zlib",
        "zlib",
        "brotli",
        "cares",
        "gtest",
        "gtest_main",
        "histogram",
        "icudata",
        "icui18n",
        "icutools",
        "icuucx",
        "libnode",
        "libuv",
        "llhttp",

        --"node_mksnapshot",
        "torque",
        "bytecode_builtins_list_generator",
        "gen-regexp-special-case"
        --"mkcodecache",
        --"mksnapshot"
    )
    set_targetdir("$(buildir)/$(os)/$(arch)/$(mode)/plugins")